---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <!-- WebGL Canvas Background -->
  <div id="webgl-container" class="fixed inset-0 -z-10"></div>

  <!-- Noise Overlay -->
  <div class="noise pointer-events-none"></div>

  <!-- Navigation - 常に見えるシンプルなナビ -->
  <nav class="fixed top-0 left-0 right-0 z-50 px-6 py-4">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <a href="#hero" class="font-bold text-light hover:text-wave-high transition-colors">
        ZAIN
      </a>
      <div class="hidden md:flex items-center gap-6 text-sm font-mono">
        <a href="#about" class="text-muted hover:text-light transition-colors">about</a>
        <a href="#skills" class="text-muted hover:text-light transition-colors">skills</a>
        <a href="#work" class="text-muted hover:text-light transition-colors">work</a>
        <a href="#contact" class="text-wave-high hover:text-life transition-colors">contact</a>
      </div>
      <!-- モバイルメニュー -->
      <div class="md:hidden flex gap-4 text-sm">
        <a href="#work" class="text-muted">work</a>
        <a href="#contact" class="text-wave-high">contact</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="relative min-h-screen" x-data="survivalApp()">

    <!-- Hero Section -->
    <section id="hero" class="min-h-screen flex flex-col justify-center px-6 md:px-12 lg:px-24">
      <div class="max-w-5xl content-backdrop">
        <!-- Terminal-style greeting with typing effect -->
        <div class="mb-8 font-mono text-sm text-muted">
          <span class="text-wave-high">$</span> <span data-typing data-typing-text="whoami" data-typing-speed="80"></span>
        </div>

        <!-- Name with glitch effect -->
        <h1
          class="glitch text-6xl md:text-8xl lg:text-9xl font-bold mb-6 tracking-tight"
          data-text="ZAIN"
        >
          <span class="text-gradient-wave">ZAIN</span>
        </h1>

        <!-- Philosophy -->
        <div class="space-y-4 mb-12">
          <p class="text-xl md:text-2xl text-light font-light tracking-wide">
            <span class="text-wave-high font-mono">Action</span>
            <span class="text-muted">=</span>
            <span class="text-wave-low font-mono">f</span>
            <span class="text-muted">(</span>
            <span class="text-pulse font-mono">Survival of Identity</span>
            <span class="text-muted">)</span>
          </p>

          <p class="text-lg text-muted italic">
            すべての行動は、アイデンティティが生き延びるためのもの
          </p>
        </div>

        <!-- Tags -->
        <div class="flex flex-wrap gap-3 mb-12">
          <span class="px-3 py-1 text-sm glass rounded-full text-wave-high border border-wave-high/30">
            Web Engineer
          </span>
          <span class="px-3 py-1 text-sm glass rounded-full text-wave-low border border-wave-low/30">
            🇵🇰→🇯🇵
          </span>
          <span class="px-3 py-1 text-sm glass rounded-full text-pulse border border-pulse/30">
            Survivor
          </span>
          <span class="px-3 py-1 text-sm glass rounded-full text-life border border-life/30">
            Pura Vida
          </span>
        </div>

        <!-- Scroll indicator -->
        <div class="scroll-indicator">
          <div class="flex items-center gap-3 text-muted text-sm">
            <span class="w-12 h-px bg-gradient-to-r from-wave-high to-transparent"></span>
            <span class="tracking-wider uppercase text-xs">scroll</span>
            <span class="scroll-arrow text-wave-high">↓</span>
          </div>
        </div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="min-h-screen flex items-center px-6 md:px-12 lg:px-24 py-24 terminal-section">
      <div class="max-w-4xl content-backdrop">
        <div class="mb-8 font-mono text-sm text-muted terminal-header">
          <span class="text-wave-high">$</span> cat about.md
        </div>

        <div class="space-y-8 text-lg leading-relaxed terminal-content" data-reveal="stagger">
          <p class="text-light">
            <span class="text-wave-high font-bold">24歳</span>。Web Engineer。フリーランス1年生。
          </p>

          <p class="text-muted">
            パキスタンで生まれ、4歳で日本に来た。日本では「外人」と呼ばれ、
            パキスタンに帰れば「日本人」と言われた。
          </p>

          <p class="text-muted">
            <span class="text-pulse">どっちの国でも、私は「外」の人間だった。</span>
          </p>

          <p class="text-muted">
            双極性障害。虐待サバイバー。元ムスリム。
            属性を並べるとこうなる。でも、これだけじゃ伝わらないことがたくさんある。
          </p>

          <blockquote class="pl-6 border-l-2 border-wave-high text-xl text-light italic">
            "私の人生は「普通」じゃない。<br>
            だから書く。私にしか書けないことを。"
          </blockquote>

          <!-- 次のセクションへの導入 -->
          <p class="text-muted pt-4">
            この背景から、私はエンジニアとしても独自の視点を持っている。
          </p>
        </div>
      </div>
    </section>

    <!-- Skills Section -->
    <section id="skills" class="min-h-screen flex items-center px-6 md:px-12 lg:px-24 py-24 terminal-section">
      <div class="w-full max-w-6xl content-backdrop">
        <div class="mb-12 font-mono text-sm text-muted terminal-header">
          <span class="text-wave-high">$</span> ls -la skills/
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 terminal-content" data-reveal="stagger">
          <!-- Skill Card -->
          <div class="glass rounded-xl p-6 hover:border-wave-high/50 transition-all duration-300 group" data-magnetic="0.2" data-hover>
            <div class="text-3xl mb-4">💻</div>
            <h3 class="text-xl font-bold text-light mb-2 group-hover:text-wave-high transition-colors">
              Web Development
            </h3>
            <p class="text-muted text-sm mb-4">
              TypeScript, React, Next.js, Astro, Node.js, Three.js
            </p>
            <div class="flex flex-wrap gap-2">
              <span class="px-2 py-1 text-xs bg-wave-high/10 text-wave-high rounded">TypeScript</span>
              <span class="px-2 py-1 text-xs bg-wave-low/10 text-wave-low rounded">React</span>
              <span class="px-2 py-1 text-xs bg-pulse/10 text-pulse rounded">Three.js</span>
            </div>
          </div>

          <!-- AI Card -->
          <div class="glass rounded-xl p-6 hover:border-wave-low/50 transition-all duration-300 group">
            <div class="text-3xl mb-4">🎨</div>
            <h3 class="text-xl font-bold text-light mb-2 group-hover:text-wave-low transition-colors">
              AI Image Generation
            </h3>
            <p class="text-muted text-sm mb-4">
              ComfyUI, Stable Diffusion, LoRA Training, Local AI Setup
            </p>
            <div class="flex flex-wrap gap-2">
              <span class="px-2 py-1 text-xs bg-wave-high/10 text-wave-high rounded">ComfyUI</span>
              <span class="px-2 py-1 text-xs bg-wave-low/10 text-wave-low rounded">SD</span>
              <span class="px-2 py-1 text-xs bg-life/10 text-life rounded">Local AI</span>
            </div>
          </div>

          <!-- Writing Card -->
          <div class="glass rounded-xl p-6 hover:border-pulse/50 transition-all duration-300 group">
            <div class="text-3xl mb-4">✍️</div>
            <h3 class="text-xl font-bold text-light mb-2 group-hover:text-pulse transition-colors">
              Writing & Content
            </h3>
            <p class="text-muted text-sm mb-4">
              技術記事、生存日記、YouTube、note
            </p>
            <div class="flex flex-wrap gap-2">
              <span class="px-2 py-1 text-xs bg-wave-high/10 text-wave-high rounded">note</span>
              <span class="px-2 py-1 text-xs bg-pulse/10 text-pulse rounded">YouTube</span>
              <span class="px-2 py-1 text-xs bg-life/10 text-life rounded">Tech Blog</span>
            </div>
          </div>
        </div>

        <!-- Stats - スキル内に統合 -->
        <div class="mt-16 pt-12 border-t border-white/10">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-6" data-reveal="stagger">
            <div class="text-center" data-magnetic="0.15">
              <div class="text-3xl font-bold text-wave-high mb-1">
                <span data-counter="24" data-counter-suffix="歳">0歳</span>
              </div>
              <div class="text-muted text-xs">Age</div>
            </div>
            <div class="text-center" data-magnetic="0.15">
              <div class="text-3xl font-bold text-wave-low mb-1">
                <span data-counter="20" data-counter-suffix="年">0年</span>
              </div>
              <div class="text-muted text-xs">In Japan</div>
            </div>
            <div class="text-center" data-magnetic="0.15">
              <div class="text-3xl font-bold text-pulse mb-1">
                <span data-counter="1" data-counter-suffix="年目">0年目</span>
              </div>
              <div class="text-muted text-xs">Freelance</div>
            </div>
            <div class="text-center" data-magnetic="0.15">
              <div class="text-3xl font-bold text-life mb-1">
                <span data-counter="100" data-counter-suffix="%">0%</span>
              </div>
              <div class="text-muted text-xs">Survival</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Articles Section - work - work -->
    <section id="work" class="min-h-screen flex items-center px-6 md:px-12 lg:px-24 py-24">
      <div class="w-full max-w-4xl content-backdrop">
        <div class="mb-12 font-mono text-sm text-muted">
          <span class="text-wave-high">$</span> tail -f articles.log
        </div>

        <div class="space-y-6">
          <!-- Article Item -->
          <a
            href="https://note.com/zain14/n/n4bb5ec70914f"
            target="_blank"
            class="block glass rounded-xl p-6 hover:border-wave-high/50 transition-all duration-300 group"
          >
            <div class="flex items-start justify-between gap-4">
              <div>
                <span class="text-xs text-wave-high font-mono mb-2 block">📌 PINNED</span>
                <h3 class="text-xl font-bold text-light mb-2 group-hover:text-wave-high transition-colors">
                  自己紹介｜パキスタン×日本×双極×虐待サバイバー×エンジニアの24歳
                </h3>
                <p class="text-muted text-sm">
                  私は、どこにも属せなかった。だから書く。私にしか書けないことを。
                </p>
              </div>
              <span class="text-2xl opacity-0 group-hover:opacity-100 transition-opacity">→</span>
            </div>
          </a>

          <a
            href="https://note.com/zain14/n/n2adc40260a7a"
            target="_blank"
            class="block glass rounded-xl p-6 hover:border-wave-low/50 transition-all duration-300 group"
          >
            <div class="flex items-start justify-between gap-4">
              <div>
                <span class="text-xs text-wave-low font-mono mb-2 block">🔥 POPULAR</span>
                <h3 class="text-xl font-bold text-light mb-2 group-hover:text-wave-low transition-colors">
                  月額0円でNSFW AIを自宅で動かす完全ガイド
                </h3>
                <p class="text-muted text-sm">
                  ゲーミングPC活用術 - ローカルAI画像生成の決定版
                </p>
              </div>
              <span class="text-2xl opacity-0 group-hover:opacity-100 transition-opacity">→</span>
            </div>
          </a>

          <a
            href="https://note.com/zain14/n/nc3e8a394636f"
            target="_blank"
            class="block glass rounded-xl p-6 hover:border-pulse/50 transition-all duration-300 group"
          >
            <div class="flex items-start justify-between gap-4">
              <div>
                <span class="text-xs text-pulse font-mono mb-2 block">💭 PHILOSOPHY</span>
                <h3 class="text-xl font-bold text-light mb-2 group-hover:text-pulse transition-colors">
                  「普通になれない」と思っていたけど、OSが違うだけだった
                </h3>
                <p class="text-muted text-sm">
                  自分を責めるのをやめて、システムとして理解する
                </p>
              </div>
              <span class="text-2xl opacity-0 group-hover:opacity-100 transition-opacity">→</span>
            </div>
          </a>
        </div>

        <div class="mt-8 text-center">
          <a
            href="https://note.com/zain14"
            target="_blank"
            class="inline-flex items-center gap-2 px-6 py-3 glass rounded-full text-wave-high hover:bg-wave-high/10 transition-colors"
          >
            <span>View all articles on note</span>
            <span>→</span>
          </a>
        </div>
      </div>
    </section>

    <!-- Contact Section - 凪 / The Calm -->
    <section id="contact" class="min-h-screen flex items-center justify-center px-6 md:px-12 lg:px-24 py-24">
      <div class="w-full max-w-4xl text-center">
        <!-- 凪のマーカー -->
        <div class="mb-16">
          <span class="inline-block px-6 py-3 text-sm font-mono text-life/80 border border-life/20 rounded-full">
            凪 — The Calm
          </span>
        </div>

        <!-- 哲学 - シンプルに中央に -->
        <div class="mb-20">
          <p class="text-5xl md:text-7xl lg:text-8xl font-light text-light/90 tracking-tight mb-4">
            <span class="text-wave-high/80">Action</span>
            <span class="text-muted/60 mx-3">=</span>
            <span class="text-wave-low/80">f</span><span class="text-muted/60">(</span><span class="text-pulse/80">S</span><span class="text-muted/60">)</span>
          </p>
          <p class="text-lg md:text-xl text-muted/60 font-light tracking-widest">
            Survival of Identity
          </p>
        </div>

        <!-- 一言だけ -->
        <p class="text-xl md:text-2xl text-light/70 font-light mb-20 max-w-xl mx-auto leading-relaxed">
          嵐を抜けた先に、この式を見つけた。
        </p>

        <!-- CTA - シンプルに -->
        <div class="flex flex-wrap justify-center gap-4">
          <a
            href="https://note.com/zain14"
            target="_blank"
            class="flex items-center gap-3 px-8 py-4 rounded-xl bg-life/10 border border-life/30 hover:bg-life/20 transition-all group"
          >
            <span class="text-xl">📝</span>
            <span class="text-light group-hover:text-life transition-colors">Story on note</span>
          </a>

          <a
            href="https://twitter.com/Hassanulzain"
            target="_blank"
            class="flex items-center gap-3 px-8 py-4 rounded-xl border border-white/10 hover:border-wave-high/30 transition-all group"
          >
            <span class="text-xl">𝕏</span>
            <span class="text-light/70 group-hover:text-wave-high transition-colors">@Hassanulzain</span>
          </a>

          <a
            href="mailto:contact@example.com"
            class="flex items-center gap-3 px-8 py-4 rounded-xl border border-white/10 hover:border-wave-low/30 transition-all group"
          >
            <span class="text-xl">✉️</span>
            <span class="text-light/70 group-hover:text-wave-low transition-colors">Mail</span>
          </a>
        </div>
      </div>
    </section>

    <!-- Footer - シンプルに -->
    <footer class="px-6 md:px-12 lg:px-24 py-12 border-t border-white/5">
      <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
        <p class="text-muted text-sm font-mono">
          <span class="text-wave-high">ZAIN</span> — Action = f(Survival)
        </p>
        <p class="text-life text-sm">Pura Vida ✨</p>
        <p class="text-muted/50 text-xs">© 2025</p>
      </div>
    </footer>

    <!-- Mood Slider (dev only - hidden by default) -->
    <div class="fixed bottom-6 right-6 glass rounded-xl p-4 z-50 opacity-0 hover:opacity-100 transition-opacity duration-300">
      <label class="text-xs text-muted block mb-2">Mood</label>
      <input
        type="range"
        min="0"
        max="100"
        value="50"
        class="w-32 accent-wave-high"
        x-model="mood"
        @input="updateMood($event.target.value)"
      >
    </div>

  </main>
</Layout>

<script>
  import Alpine from 'alpinejs';
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  import { SurvivalWave } from '../scripts/webgl/SurvivalWave';
  import { ExistenceCursor } from '../scripts/cursor/ExistenceCursor';
  import { OpeningSequence } from '../scripts/animation/OpeningSequence';
  import { initSectionReveals, initMagneticElements } from '../scripts/animation/SectionReveal';
  import { ProgressIndicator, initCounters } from '../scripts/animation/ProgressIndicator';
  import { initTypingEffects } from '../scripts/animation/TypingEffect';

  gsap.registerPlugin(ScrollTrigger);

  // Keep instances OUTSIDE Alpine's reactive scope
  let waveInstance: SurvivalWave | null = null;
  let cursorInstance: ExistenceCursor | null = null;

  // Hide content initially for opening
  document.body.style.overflow = 'hidden';

  // Register Alpine data before starting
  Alpine.data('survivalApp', () => ({
    mood: 50,
    isLoaded: false,

    init() {
      // Opening sequence
      new OpeningSequence({
        onComplete: () => {
          this.isLoaded = true;
          document.body.style.overflow = '';
          this.initWebGL();
          this.initCursor();
          this.initAnimations();
        }
      });
    },

    initWebGL() {
      const container = document.getElementById('webgl-container');
      if (container && !waveInstance) {
        waveInstance = new SurvivalWave({
          container,
          particleCount: 100
        });
        waveInstance.mount();

        // Connect scroll to wave
        window.addEventListener('scroll', () => {
          const scrollY = window.scrollY;
          const maxScroll = document.body.scrollHeight - window.innerHeight;
          const scrollProgress = scrollY / maxScroll;

          // Shift mood slightly based on scroll
          const scrollMood = 0.4 + scrollProgress * 0.2;
          if (waveInstance && this.mood === 50) {
            waveInstance.setMood(scrollMood);
          }
        });
      }
    },

    initCursor() {
      // Only on desktop
      if (window.matchMedia('(pointer: fine)').matches) {
        cursorInstance = new ExistenceCursor({
          container: document.body
        });

        // Hide default cursor
        document.body.style.cursor = 'none';
        document.querySelectorAll('a, button').forEach(el => {
          (el as HTMLElement).style.cursor = 'none';
        });
      }
    },

    initAnimations() {
      // Section reveals
      initSectionReveals();
      initMagneticElements();

      // Typing effects
      initTypingEffects();

      // Counters
      initCounters();

      // Progress indicator (desktop only)
      if (window.innerWidth >= 1024) {
        new ProgressIndicator();
      }

      // Hero text animation
      gsap.from('.glitch', {
        opacity: 0,
        y: 100,
        duration: 1,
        ease: 'power3.out',
        delay: 0.2
      });

      gsap.from('#hero .space-y-4 > *', {
        opacity: 0,
        y: 30,
        duration: 0.8,
        stagger: 0.15,
        ease: 'power2.out',
        delay: 0.5
      });

      gsap.from('#hero .flex-wrap > *', {
        opacity: 0,
        scale: 0.8,
        duration: 0.5,
        stagger: 0.1,
        ease: 'back.out(1.7)',
        delay: 1
      });
    },

    updateMood(value: string) {
      const normalizedMood = parseInt(value) / 100;
      if (waveInstance) {
        waveInstance.setMood(normalizedMood);
      }
    }
  }));

  // Start Alpine
  window.Alpine = Alpine;
  Alpine.start();
</script>
